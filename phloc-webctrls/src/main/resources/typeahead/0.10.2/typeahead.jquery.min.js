(function(g){var v,w,s,x,y,z,A,B,C,D,E,F,G,H,e={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(c){return!c||/^\s*$/.test(c)},escapeRegExChars:function(c){return c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(c){return"string"===typeof c},isNumber:function(c){return"number"===typeof c},isArray:g.isArray,isFunction:g.isFunction,isObject:g.isPlainObject,isUndefined:function(c){return"undefined"===
typeof c},bind:g.proxy,each:function(c,e){g.each(c,function(b,a){return e(a,b)})},map:g.map,filter:g.grep,every:function(c,e){var b=!0;if(!c)return b;g.each(c,function(a,d){if(!(b=e.call(null,d,a,c)))return!1});return!!b},some:function(c,e){var b=!1;if(!c)return b;g.each(c,function(a,d){if(b=e.call(null,d,a,c))return!1});return!!b},mixin:g.extend,getUniqueId:function(){var c=0;return function(){return c++}}(),templatify:function(c){function e(){return String(c)}return g.isFunction(c)?c:e},defer:function(c){setTimeout(c,
0)},debounce:function(c,e,b){var a,d;return function(){var k=this,f=arguments,p;p=b&&!a;clearTimeout(a);a=setTimeout(function(){a=null;b||(d=c.apply(k,f))},e);p&&(d=c.apply(k,f));return d}},throttle:function(c,e){var b,a,d,k,f,p;f=0;p=function(){f=new Date;d=null;k=c.apply(b,a)};return function(){var l=new Date,g=e-(l-f);b=this;a=arguments;0>=g?(clearTimeout(d),d=null,f=l,k=c.apply(b,a)):d||(d=setTimeout(p,g));return k}},noop:function(){}};D='<span class="twitter-typeahead"></span>';E='<span class="tt-dropdown-menu"></span>';
F='<div class="tt-dataset-%CLASS%"></div>';G='<span class="tt-suggestions"></span>';H='<div class="tt-suggestion"></div>';v={position:"relative",display:"inline-block"};w={position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"};s={position:"relative",verticalAlign:"top",backgroundColor:"transparent"};x={position:"relative",verticalAlign:"top"};y={position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"};z={display:"block"};A={whiteSpace:"normal"};B={left:"0",right:"auto"};
C={left:"auto",right:" 0"};e.isMsie()&&e.mixin(s,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"});e.isMsie()&&7>=e.isMsie()&&e.mixin(s,{marginTop:"-1px"});var I=function(){function c(c){c&&c.el||g.error("EventBus initialized without el");this.$el=g(c.el)}e.mixin(c.prototype,{trigger:function(c){var b=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+c,b)}});return c}(),u=function(){function c(d,f,c,e){if(!c)return this;f=f.split(a);c=
e?b(c,e):c;for(this._callbacks=this._callbacks||{};e=f.shift();)this._callbacks[e]=this._callbacks[e]||{sync:[],async:[]},this._callbacks[e][d].push(c);return this}function e(a,f,d){return function(){for(var b,c=0;!b&&c<a.length;c+=1)b=!1===a[c].apply(f,d);return!b}}function b(a,f){return a.bind?a.bind(f):function(){a.apply(f,[].slice.call(arguments,0))}}var a=/\s+/,d=function(){return window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},0)}}();return{onSync:function(a,
f,d){return c.call(this,"sync",a,f,d)},onAsync:function(a,f,d){return c.call(this,"async",a,f,d)},off:function(d){var f;if(!this._callbacks)return this;for(d=d.split(a);f=d.shift();)delete this._callbacks[f];return this},trigger:function(k){var f,b,c,g,q;if(!this._callbacks)return this;k=k.split(a);for(c=[].slice.call(arguments,1);(f=k.shift())&&(b=this._callbacks[f]);)g=e(b.sync,this,[f].concat(c)),q=e(b.async,this,[f].concat(c)),g()&&d(q);return this}}}(),K=function(c){function g(a,d,b){for(var f=
[],c=0;c<a.length;c++)f.push(e.escapeRegExChars(a[c]));a=b?"\\b("+f.join("|")+")\\b":"("+f.join("|")+")";return d?RegExp(a):RegExp(a,"i")}var b={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(a){function d(d){var b,k;if(b=f.exec(d.data))wrapperNode=c.createElement(a.tagName),a.className&&(wrapperNode.className=a.className),k=d.splitText(b.index),k.splitText(b[0].length),wrapperNode.appendChild(k.cloneNode(!0)),d.parentNode.replaceChild(wrapperNode,
k);return!!b}function k(a,f){for(var d,b=0;b<a.childNodes.length;b++)d=a.childNodes[b],3===d.nodeType?b+=f(d)?1:0:k(d,f)}var f;a=e.mixin({},b,a);a.node&&a.pattern&&(a.pattern=e.isArray(a.pattern)?a.pattern:[a.pattern],f=g(a.pattern,a.caseSensitive,a.wordsOnly),k(a.node,d))}}(window.document),J=function(){function c(a){var d=this,c,f,p,l;a=a||{};a.input||g.error("input is missing");c=e.bind(this._onBlur,this);f=e.bind(this._onFocus,this);p=e.bind(this._onKeydown,this);l=e.bind(this._onInput,this);
this.$hint=g(a.hint);this.$input=g(a.input).on("blur.tt",c).on("focus.tt",f).on("keydown.tt",p);0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop);if(e.isMsie())this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){b[a.which||a.keyCode]||e.defer(e.bind(d._onInput,d,a))});else this.$input.on("input.tt",l);this.query=this.$input.val();this.$overflowHelper=g('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",
fontFamily:this.$input.css("font-family"),fontSize:this.$input.css("font-size"),fontStyle:this.$input.css("font-style"),fontVariant:this.$input.css("font-variant"),fontWeight:this.$input.css("font-weight"),wordSpacing:this.$input.css("word-spacing"),letterSpacing:this.$input.css("letter-spacing"),textIndent:this.$input.css("text-indent"),textRendering:this.$input.css("text-rendering"),textTransform:this.$input.css("text-transform")}).insertAfter(this.$input)}function h(a){return a.altKey||a.ctrlKey||
a.metaKey||a.shiftKey}var b;b={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};c.normalizeQuery=function(a){return(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")};e.mixin(c.prototype,u,{_onBlur:function(){this.resetInputValue();this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(a){var d=b[a.which||a.keyCode];this._managePreventDefault(d,a);d&&this._shouldTrigger(d,a)&&this.trigger(d+"Keyed",a)},_onInput:function(){this._checkInputValue()},
_managePreventDefault:function(a,d){var b,f;switch(a){case "tab":b=this.getHint();f=this.getInputValue();b=b&&b!==f&&!h(d);break;case "up":case "down":b=!h(d);break;default:b=!1}b&&d.preventDefault()},_shouldTrigger:function(a,d){var b;switch(a){case "tab":b=!h(d);break;default:b=!0}return b},_checkInputValue:function(){var a,d,b;a=this.getInputValue();b=(d=c.normalizeQuery(a)===c.normalizeQuery(this.query))?this.query.length!==a.length:!1;d?b&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",
this.query=a)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,d){this.$input.val(a);d?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(a){this.$hint.val(a)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var a,
d;a=this.getInputValue();d=this.getHint();d=a!==d&&0===d.indexOf(a);""!==a&&d&&!this.hasOverflow()||this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var a=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=a},isCursorAtEnd:function(){var a,d;a=this.$input.val().length;d=this.$input[0].selectionStart;return e.isNumber(d)?d===a:document.selection?(d=document.selection.createRange(),
d.moveStart("character",-a),a===d.text.length):!0},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null}});return c}(),t=function(){function c(a){a=a||{};a.templates=a.templates||{};a.source||g.error("missing source");a.name&&!/^[_a-zA-Z0-9-]+$/.test(a.name)&&g.error("invalid dataset name: "+a.name);this.query=null;this.highlight=!!a.highlight;this.name=a.name||e.getUniqueId();this.source=a.source;this.displayFn=h(a.display||a.displayKey);
this.templates=b(a.templates,this.displayFn);this.$el=g(F.replace("%CLASS%",this.name))}function h(a){function d(b){return b[a]}a=a||"value";return e.isFunction(a)?a:d}function b(a,d){function b(a){return"<p>"+d(a)+"</p>"}return{empty:a.empty&&e.templatify(a.empty),header:a.header&&e.templatify(a.header),footer:a.footer&&e.templatify(a.footer),suggestion:a.suggestion||b}}var a="ttDataset",d="ttValue",k="ttDatum";c.extractDatasetName=function(d){return g(d).data(a)};c.extractValue=function(a){return g(a).data(d)};
c.extractDatum=function(a){return g(a).data(k)};e.mixin(c.prototype,u,{_render:function(b,c){function h(){var l,n;l=g(G).css(z);n=e.map(c,function(b){b=g(H).append(m.templates.suggestion(b)).data(a,m.name).data(d,m.displayFn(b)).data(k,b);b.children().each(function(){g(this).css(A)});return b});l.append.apply(l,n);m.highlight&&K({node:l[0],pattern:b});return l}function n(){return m.templates.header({query:b,isEmpty:!r})}function q(){return m.templates.footer({query:b,isEmpty:!r})}if(this.$el){var m=
this,r;this.$el.empty();r=c&&c.length;!r&&this.templates.empty?this.$el.html(m.templates.empty({query:b,isEmpty:!0})).prepend(m.templates.header?n():null).append(m.templates.footer?q():null):r&&this.$el.html(h()).prepend(m.templates.header?n():null).append(m.templates.footer?q():null);this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(a){var d=this;this.query=a;this.canceled=!1;this.source(a,function(b){d.canceled||a!==d.query||d._render(a,b)})},cancel:function(){this.canceled=
!0},clear:function(){this.cancel();this.$el.empty();this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}});return c}(),L=function(){function c(b){var a=this,d,c,f;b=b||{};b.menu||g.error("menu is required");this.isOpen=!1;this.isEmpty=!0;this.datasets=e.map(b.datasets,h);d=e.bind(this._onSuggestionClick,this);c=e.bind(this._onSuggestionMouseEnter,this);f=e.bind(this._onSuggestionMouseLeave,this);this.$menu=g(b.menu).on("click.tt",".tt-suggestion",
d).on("mouseenter.tt",".tt-suggestion",c).on("mouseleave.tt",".tt-suggestion",f);e.each(this.datasets,function(d){a.$menu.append(d.getRoot());d.onSync("rendered",a._onRendered,a)})}function h(b){return new t(b)}e.mixin(c.prototype,u,{_onSuggestionClick:function(b){this.trigger("suggestionClicked",g(b.currentTarget))},_onSuggestionMouseEnter:function(b){this._removeCursor();this._setCursor(g(b.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){(this.isEmpty=
e.every(this.datasets,function(b){return b.isEmpty()}))?this._hide():this.isOpen&&this._show();this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(b,a){b.first().addClass("tt-cursor");!a&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},
_moveCursor:function(b){var a,d;this.isOpen&&(d=this._getCursor(),a=this._getSuggestions(),this._removeCursor(),b=a.index(d)+b,b=(b+1)%(a.length+1)-1,-1===b?this.trigger("cursorRemoved"):(-1>b&&(b=a.length-1),this._setCursor(a=a.eq(b)),this._ensureVisible(a)))},_ensureVisible:function(b){var a,d,c;a=b.position().top;b=a+b.outerHeight(!0);d=this.$menu.scrollTop();c=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);0>a?this.$menu.scrollTop(d+
a):c<b&&this.$menu.scrollTop(d+(b-c))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(b){this.$menu.css("ltr"===b?B:C)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(b){var a=null;b.length&&(a={raw:t.extractDatum(b),value:t.extractValue(b),
datasetName:t.extractDatasetName(b)});return a},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(b){e.each(this.datasets,function(a){a.update(b)})},empty:function(){e.each(this.datasets,function(b){b.clear()});this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){this.$menu.off(".tt");this.$menu=null;
e.each(this.datasets,function(b){b.destroy()})}});return c}(),M=function(){function c(a){var b,f,c;a=a||{};a.input||g.error("missing input");this.isActivated=!1;this.autoselect=!!a.autoselect;this.minLength=e.isNumber(a.minLength)?a.minLength:1;this.$node=h(a.input,a.withHint);b=this.$node.find(".tt-dropdown-menu");f=this.$node.find(".tt-input");c=this.$node.find(".tt-hint");f.on("blur.tt",function(a){var d,c;d=document.activeElement;c=b.is(d);d=0<b.has(d).length;e.isMsie()&&(c||d)&&(a.preventDefault(),
a.stopImmediatePropagation(),e.defer(function(){f.focus()}))});b.on("mousedown.tt",function(a){a.preventDefault()});this.eventBus=a.eventBus||new I({el:f});this.dropdown=(new L({menu:b,datasets:a.datasets})).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=
(new J({input:f,hint:c})).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,
this);this._setLanguageDirection()}function h(d,b){var c,e,h,n;c=g(d);e=g(D).css(v);h=g(E).css(y);n=c.clone().css(w).css({backgroundAttachment:c.css("background-attachment"),backgroundClip:c.css("background-clip"),backgroundColor:c.css("background-color"),backgroundImage:c.css("background-image"),backgroundOrigin:c.css("background-origin"),backgroundPosition:c.css("background-position"),backgroundRepeat:c.css("background-repeat"),backgroundSize:c.css("background-size")});n.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled",
!0).attr({autocomplete:"off",spellcheck:"false"});c.data(a,{dir:c.attr("dir"),autocomplete:c.attr("autocomplete"),spellcheck:c.attr("spellcheck"),style:c.attr("style")});c.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(b?s:x);try{!c.attr("dir")&&c.attr("dir","auto")}catch(q){}return c.wrap(e).parent().prepend(b?n:null).append(h)}function b(d){var b=d.find(".tt-input");e.each(b.data(a),function(a,d){e.isUndefined(a)?b.removeAttr(d):b.attr(d,a)});b.detach().removeData(a).removeClass("tt-input").insertAfter(d);
d.remove()}var a="ttAttrs";e.mixin(c.prototype,{_onSuggestionClicked:function(a,b){var c;(c=this.dropdown.getDatumForSuggestion(b))&&this._select(c)},_onCursorMoved:function(){var a=this.dropdown.getDatumForCursor();this.input.setInputValue(a.value,!0);this.eventBus.trigger("cursorchanged",a.raw,a.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint();this.eventBus.trigger("opened")},
_onClosed:function(){this.input.clearHint();this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0;this.dropdown.open()},_onBlurred:function(){this.isActivated=!1;this.dropdown.empty();this.dropdown.close()},_onEnterKeyed:function(a,b){var c,e;c=this.dropdown.getDatumForCursor();e=this.dropdown.getDatumForTopSuggestion();c?(this._select(c),b.preventDefault()):this.autoselect&&e&&(this._select(e),b.preventDefault())},_onTabKeyed:function(a,b){var c;(c=this.dropdown.getDatumForCursor())?
(this._select(c),b.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close();this.input.resetInputValue()},_onUpKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorUp();this.dropdown.open()},_onDownKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorDown();this.dropdown.open()},_onLeftKeyed:function(){"rtl"===
this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(a,b){this.input.clearHintIfInvalid();b.length>=this.minLength?this.dropdown.update(b):this.dropdown.empty();this.dropdown.open();this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function(){var a;this.dir!==(a=this.input.getLanguageDirection())&&(this.dir=a,this.$node.css("direction",a),this.dropdown.setLanguageDirection(a))},
_updateHint:function(){var a,b,c;(a=this.dropdown.getDatumForTopSuggestion())&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(b=this.input.getInputValue(),c=J.normalizeQuery(b),c=e.escapeRegExChars(c),c=RegExp("^(?:"+c+")(.+$)","i"),(a=c.exec(a.value))?this.input.setHint(b+a[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(a){var b,c;b=this.input.getHint();c=this.input.getQuery();a=a||this.input.isCursorAtEnd();b&&c!==b&&a&&((b=this.dropdown.getDatumForTopSuggestion())&&
this.input.setInputValue(b.value),this.eventBus.trigger("autocompleted",b.raw,b.datasetName))},_select:function(a){this.input.setQuery(a.value);this.input.setInputValue(a.value,!0);this._setLanguageDirection();this.eventBus.trigger("selected",a.raw,a.datasetName);this.dropdown.close();e.defer(e.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(a){this.isActivated?this.input.setInputValue(a):(this.input.setQuery(a),
this.input.setInputValue(a,!0));this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy();this.dropdown.destroy();b(this.$node);this.$node=null}});return c}();(function(){var c,h,b;c=g.fn.typeahead;h="ttTypeahead";b={initialize:function(a,b){b=e.isArray(b)?b:[].slice.call(arguments,1);a=a||{};return this.each(function(){var c=g(this),f;e.each(b,function(b){b.highlight=!!a.highlight});f=new M({input:c,eventBus:new I({el:c}),withHint:e.isUndefined(a.hint)?
!0:!!a.hint,minLength:a.minLength,autoselect:a.autoselect,datasets:b});c.data(h,f)})},open:function(){return this.each(function(){var a;(a=g(this).data(h))&&a.open()})},close:function(){return this.each(function(){var a;(a=g(this).data(h))&&a.close()})},val:function(a){function b(){var c;(c=g(this).data(h))&&c.setVal(a)}function c(a){var b;if(a=a.data(h))b=a.getVal();return b}return arguments.length?this.each(b):c(this.first())},destroy:function(){return this.each(function(){var a=g(this),b;if(b=
a.data(h))b.destroy(),a.removeData(h)})}};g.fn.typeahead=function(a){return b[a]?b[a].apply(this,[].slice.call(arguments,1)):b.initialize.apply(this,arguments)};g.fn.typeahead.noConflict=function(){g.fn.typeahead=c;return this}})()})(window.jQuery);
