(function(l){var g={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(a){return!a||/^\s*$/.test(a)},escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(a){return"string"===typeof a},isNumber:function(a){return"number"===typeof a},isArray:l.isArray,isFunction:l.isFunction,isObject:l.isPlainObject,isUndefined:function(a){return"undefined"===
typeof a},bind:l.proxy,each:function(a,d){l.each(a,function(a,h){return d(h,a)})},map:l.map,filter:l.grep,every:function(a,d){var b=!0;if(!a)return b;l.each(a,function(h,c){if(!(b=d.call(null,c,h,a)))return!1});return!!b},some:function(a,d){var b=!1;if(!a)return b;l.each(a,function(h,c){if(b=d.call(null,c,h,a))return!1});return!!b},mixin:l.extend,getUniqueId:function(){var a=0;return function(){return a++}}(),templatify:function(a){function d(){return String(a)}return l.isFunction(a)?a:d},defer:function(a){setTimeout(a,
0)},debounce:function(a,d,b){var h,c;return function(){var e=this,f=arguments,k;k=b&&!h;clearTimeout(h);h=setTimeout(function(){h=null;b||(c=a.apply(e,f))},d);k&&(c=a.apply(e,f));return c}},throttle:function(a,d){var b,h,c,e,f,k;f=0;k=function(){f=new Date;c=null;e=a.apply(b,h)};return function(){var m=new Date,q=d-(m-f);b=this;h=arguments;0>=q?(clearTimeout(c),c=null,f=m,e=a.apply(b,h)):c||(c=setTimeout(k,q));return e}},noop:function(){}},u=function(a){function d(c){return c.split(/\s+/)}function b(c){return c.split(/\W+/)}
function h(c){return function(a){return function(f){return c(f[a])}}}return{nonword:b,whitespace:d,obj:{nonword:h(b),whitespace:h(d)}}}(),r=function(){function a(a){this.maxSize=a||100;this.size=0;this.hash={};this.list=new d}function d(){this.head=this.tail=null}function b(a,c){this.key=a;this.val=c;this.prev=this.next=null}g.mixin(a.prototype,{set:function(a,c){var e=this.list.tail;this.size>=this.maxSize&&(this.list.remove(e),delete this.hash[e.key]);(e=this.hash[a])?(e.val=c,this.list.moveToFront(e)):
(e=new b(a,c),this.list.add(e),this.hash[a]=e,this.size++)},get:function(a){if(a=this.hash[a])return this.list.moveToFront(a),a.val}});g.mixin(d.prototype,{add:function(a){this.head&&(a.next=this.head,this.head.prev=a);this.head=a;this.tail=this.tail||a},remove:function(a){a.prev?a.prev.next=a.next:this.head=a.next;a.next?a.next.prev=a.prev:this.tail=a.prev},moveToFront:function(a){this.remove(a);this.add(a)}});return a}(),v=function(){function a(a){this.prefix=["__",a,"__"].join("");this.ttlKey=
"__ttl__";this.keyMatcher=RegExp("^"+this.prefix)}function d(a){return JSON.stringify(g.isUndefined(a)?null:a)}var b;try{b=window.localStorage,b.setItem("~~~","!"),b.removeItem("~~~")}catch(h){b=null}g.mixin(a.prototype,b&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){this.isExpired(a)&&this.remove(a);a=b.getItem(this._prefix(a));return JSON.parse(a)},set:function(a,e,f){g.isNumber(f)?b.setItem(this._ttlKey(a),d((new Date).getTime()+
f)):b.removeItem(this._ttlKey(a));return b.setItem(this._prefix(a),d(e))},remove:function(a){b.removeItem(this._ttlKey(a));b.removeItem(this._prefix(a));return this},clear:function(){var a,e,f=[],k=b.length;for(a=0;a<k;a++)(e=b.key(a)).match(this.keyMatcher)&&f.push(e.replace(this.keyMatcher,""));for(a=f.length;a--;)this.remove(f[a]);return this},isExpired:function(a){a=b.getItem(this._ttlKey(a));a=JSON.parse(a);return g.isNumber(a)&&(new Date).getTime()>a?!0:!1}}:{get:g.noop,set:g.noop,remove:g.noop,
clear:g.noop,isExpired:g.noop});return a}(),t=function(){function a(a){a=a||{};this._send=a.transport?d(a.transport):l.ajax;this._get=a.rateLimiter?a.rateLimiter(this._get):this._get}function d(a){return function(e,c){var b=l.Deferred();a(e,c,function(a){g.defer(function(){b.resolve(a)})},function(a){g.defer(function(){b.reject(a)})});return b}}var b=0,h={},c=6,e=new r(10);a.setMaxPendingRequests=function(a){c=a};a.resetCache=function(){e=new r(10)};g.mixin(a.prototype,{_get:function(a,k,m){function d(c){m&&
m(null,c);e.set(a,c)}function g(){m&&m(!0)}function l(){b--;delete h[a];n.onDeckRequestArgs&&(n._get.apply(n,n.onDeckRequestArgs),n.onDeckRequestArgs=null)}var n=this,s;(s=h[a])?s.done(d).fail(g):b<c?(b++,h[a]=this._send(a,k).done(d).fail(g).always(l)):this.onDeckRequestArgs=[].slice.call(arguments,0)},get:function(a,c,m){var b;g.isFunction(c)&&(m=c,c={});(b=e.get(a))?g.defer(function(){m&&m(null,b)}):this._get(a,c,m);return!!b}});return a}(),w=function(){function a(a){a=a||{};a.datumTokenizer&&a.queryTokenizer||
l.error("datumTokenizer and queryTokenizer are both required");this.datumTokenizer=a.datumTokenizer;this.queryTokenizer=a.queryTokenizer;this.reset()}function d(a){a=g.filter(a,function(a){return!!a});return a=g.map(a,function(a){return a.toLowerCase()})}function b(a){for(var e={},f=[],k=0;k<a.length;k++)e[a[k]]||(e[a[k]]=!0,f.push(a[k]));return f}function h(a,e){function f(a,e){return a-e}var k=0,m=0,b=[];a=a.sort(f);for(e=e.sort(f);k<a.length&&m<e.length;)a[k]<e[m]?k++:(a[k]>e[m]||(b.push(a[k]),
k++),m++);return b}g.mixin(a.prototype,{bootstrap:function(a){this.datums=a.datums;this.trie=a.trie},add:function(a){var e=this;a=g.isArray(a)?a:[a];g.each(a,function(a){var k;k=e.datums.push(a)-1;a=d(e.datumTokenizer(a));g.each(a,function(a){var b,f;b=e.trie;for(a=a.split("");f=a.shift();)b=b.children[f]||(b.children[f]={ids:[],children:{}}),b.ids.push(k)})})},get:function(a){var e=this,f;a=d(this.queryTokenizer(a));g.each(a,function(a){var b,c;if(f&&0===f.length)return!1;b=e.trie;for(a=a.split("");b&&
(c=a.shift());)b=b.children[c];if(b&&0===a.length)b=b.ids.slice(0),f=f?h(f,b):b;else return f=[],!1});return f?g.map(b(f),function(a){return e.datums[a]}):[]},reset:function(){this.datums=[];this.trie={ids:[],children:{}}},serialize:function(){return{datums:this.datums,trie:this.trie}}});return a}(),p=function(){return{local:function(a){return a.local||null},prefetch:function(a){var d;d={url:null,thumbprint:"",ttl:864E5,filter:null,ajax:{}};if(a=a.prefetch||null)a=g.isString(a)?{url:a}:a,a=g.mixin(d,
a),a.thumbprint="0.10.2"+a.thumbprint,a.ajax.type=a.ajax.type||"GET",a.ajax.dataType=a.ajax.dataType||"json",!a.url&&l.error("prefetch requires url to be set");return a},remote:function(a){function d(a){return function(e){return g.debounce(e,a)}}function b(a){return function(e){return g.throttle(e,a)}}var h;h={url:null,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}};if(a=a.remote||null)a=g.isString(a)?{url:a}:a,a=g.mixin(h,a),a.rateLimiter=/^throttle$/i.test(a.rateLimitBy)?
b(a.rateLimitWait):d(a.rateLimitWait),a.ajax.type=a.ajax.type||"GET",a.ajax.dataType=a.ajax.dataType||"json",delete a.rateLimitBy,delete a.rateLimitWait,!a.url&&l.error("remote requires url to be set");return a}}}();(function(a){function d(a){a&&(a.local||a.prefetch||a.remote)||l.error("one of local, prefetch, or remote is required");this.limit=a.limit||5;this.sorter=b(a.sorter);this.dupDetector=a.dupDetector||h;this.local=p.local(a);this.prefetch=p.prefetch(a);this.remote=p.remote(a);this.cacheKey=
this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null;this.index=new w({datumTokenizer:a.datumTokenizer,queryTokenizer:a.queryTokenizer});this.storage=this.cacheKey?new v(this.cacheKey):null}function b(a){function b(f){return f.sort(a)}function k(a){return a}return g.isFunction(a)?b:k}function h(){return!1}var c;c=a.Bloodhound;a.Bloodhound=d;d.noConflict=function(){a.Bloodhound=c;return d};d.tokenizers=u;g.mixin(d.prototype,{_loadPrefetch:function(a){function b(f){k.clear();k.add(a.filter?
a.filter(f):f);k._saveToStorage(k.index.serialize(),a.thumbprint,a.ttl)}var k=this,c;(c=this._readFromStorage(a.thumbprint))?(this.index.bootstrap(c),c=l.Deferred().resolve()):c=l.ajax(a.url,a.ajax).done(b);return c},_getFromRemote:function(a,b){var c=this,d;a=a||"";d=encodeURIComponent(a);d=this.remote.replace?this.remote.replace(this.remote.url,a):this.remote.url.replace(this.remote.wildcard,d);return this.transport.get(d,this.remote.ajax,function(a,e){a?b([]):b(c.remote.filter?c.remote.filter(e):
e)})},_saveToStorage:function(a,b,c){this.storage&&(this.storage.set("data",a,c),this.storage.set("protocol",location.protocol,c),this.storage.set("thumbprint",b,c))},_readFromStorage:function(a){var b,c,d;this.storage&&(b=this.storage.get("data"),c=this.storage.get("protocol"),d=this.storage.get("thumbprint"));a=d!==a||c!==location.protocol;return b&&!a?b:null},_initialize:function(){function a(){b.add(g.isFunction(c)?c():c)}var b=this,c=this.local,d;d=this.prefetch?this._loadPrefetch(this.prefetch):
l.Deferred().resolve();c&&d.done(a);this.transport=this.remote?new t(this.remote):null;return this.initPromise=d.promise()},initialize:function(a){return!this.initPromise||a?this._initialize():this.initPromise},add:function(a){this.index.add(a)},get:function(a,b){function c(a){var e=h.slice(0);g.each(a,function(a){!g.some(e,function(b){return d.dupDetector(a,b)})&&e.push(a);return e.length<d.limit});b&&b(d.sorter(e))}var d=this,h=[],l=!1,h=this.index.get(a),h=this.sorter(h).slice(0,this.limit);h.length<
this.limit&&this.transport&&(l=this._getFromRemote(a,c));l||(0<h.length||!this.transport)&&b&&b(h)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&t.resetCache()},ttAdapter:function(){return g.bind(this.get,this)}});return d})(this)})(window.jQuery);
