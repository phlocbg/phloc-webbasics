(function(g){var w,x,s,y,z,A,B,C,D,E,F,G,H,I,d={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(b){return!b||/^\s*$/.test(b)},escapeRegExChars:function(b){return b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(b){return"string"===typeof b},isNumber:function(b){return"number"===typeof b},isArray:g.isArray,isFunction:g.isFunction,isObject:g.isPlainObject,isUndefined:function(b){return"undefined"===
typeof b},bind:g.proxy,each:function(b,d){g.each(b,function(b,c){return d(c,b)})},map:g.map,filter:g.grep,every:function(b,d){var e=!0;if(!b)return e;g.each(b,function(c,a){if(!(e=d.call(null,a,c,b)))return!1});return!!e},some:function(b,d){var e=!1;if(!b)return e;g.each(b,function(c,a){if(e=d.call(null,a,c,b))return!1});return!!e},mixin:g.extend,getUniqueId:function(){var b=0;return function(){return b++}}(),templatify:function(b){function d(){return String(b)}return g.isFunction(b)?b:d},defer:function(b){setTimeout(b,
0)},debounce:function(b,d,e){var c,a;return function(){var k=this,f=arguments,l;l=e&&!c;clearTimeout(c);c=setTimeout(function(){c=null;e||(a=b.apply(k,f))},d);l&&(a=b.apply(k,f));return a}},throttle:function(b,d){var e,c,a,k,f,l;f=0;l=function(){f=new Date;a=null;k=b.apply(e,c)};return function(){var r=new Date,n=d-(r-f);e=this;c=arguments;0>=n?(clearTimeout(a),a=null,f=r,k=b.apply(e,c)):a||(a=setTimeout(l,n));return k}},noop:function(){}},J=function(b,g){function e(a){this.maxSize=a||100;this.size=
0;this.hash={};this.list=new c}function c(){this.head=this.tail=null}function a(a,f){this.key=a;this.val=f;this.prev=this.next=null}d.mixin(e.prototype,{set:function(c,f){var l=this.list.tail;this.size>=this.maxSize&&(this.list.remove(l),delete this.hash[l.key]);(l=this.hash[c])?(l.val=f,this.list.moveToFront(l)):(l=new a(c,f),this.list.add(l),this.hash[c]=l,this.size++)},get:function(a){if(a=this.hash[a])return this.list.moveToFront(a),a.val}});d.mixin(c.prototype,{add:function(a){this.head&&(a.next=
this.head,this.head.prev=a);this.head=a;this.tail=this.tail||a},remove:function(a){a.prev?a.prev.next=a.next:this.head=a.next;a.next?a.next.prev=a.prev:this.tail=a.prev},moveToFront:function(a){this.remove(a);this.add(a)}});return e}(this),M=function(){function b(a){this.prefix=["__",a,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=RegExp("^"+this.prefix)}function g(a){return JSON.stringify(d.isUndefined(a)?null:a)}var e;try{e=window.localStorage,e.setItem("~~~","!"),e.removeItem("~~~")}catch(c){e=
null}d.mixin(b.prototype,e&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){this.isExpired(a)&&this.remove(a);a=e.getItem(this._prefix(a));return JSON.parse(a)},set:function(a,c,f){d.isNumber(f)?e.setItem(this._ttlKey(a),g((new Date).getTime()+f)):e.removeItem(this._ttlKey(a));return e.setItem(this._prefix(a),g(c))},remove:function(a){e.removeItem(this._ttlKey(a));e.removeItem(this._prefix(a));return this},clear:function(){var a,
c,f=[],l=e.length;for(a=0;a<l;a++)(c=e.key(a)).match(this.keyMatcher)&&f.push(c.replace(this.keyMatcher,""));for(a=f.length;a--;)this.remove(f[a]);return this},isExpired:function(a){a=e.getItem(this._ttlKey(a));a=JSON.parse(a);return d.isNumber(a)&&(new Date).getTime()>a?!0:!1}}:{get:d.noop,set:d.noop,remove:d.noop,clear:d.noop,isExpired:d.noop});return b}(),N=function(){function b(a){a=a||{};this._send=a.transport?h(a.transport):g.ajax;this._get=a.rateLimiter?a.rateLimiter(this._get):this._get}function h(a){return function(c,
k){var b=g.Deferred();a(c,k,function(a){d.defer(function(){b.resolve(a)})},function(a){d.defer(function(){b.reject(a)})});return b}}var e=0,c={},a=6,k=new J(10);b.setMaxPendingRequests=function(f){a=f};b.resetCache=function(){k=new J(10)};d.mixin(b.prototype,{_get:function(f,b,d){function g(a){d&&d(a);k.set(f,a)}function h(){e--;delete c[f];m.onDeckRequestArgs&&(m._get.apply(m,m.onDeckRequestArgs),m.onDeckRequestArgs=null)}var m=this,p;(p=c[f])?p.done(g):e<a?(e++,c[f]=this._send(f,b).done(g).always(h)):
this.onDeckRequestArgs=[].slice.call(arguments,0)},get:function(a,c,b){var e;d.isFunction(c)&&(b=c,c={});(e=k.get(a))?d.defer(function(){b&&b(e)}):this._get(a,c,b);return!!e}});return b}(),O=function(){function b(a){a=a||{};a.datumTokenizer&&a.queryTokenizer||g.error("datumTokenizer and queryTokenizer are both required");this.datumTokenizer=a.datumTokenizer;this.queryTokenizer=a.queryTokenizer;this.datums=[];this.trie={ids:[],children:{}}}function h(a){a=d.filter(a,function(a){return!!a});return a=
d.map(a,function(a){return a.toLowerCase()})}function e(a){for(var c={},f=[],b=0;b<a.length;b++)c[a[b]]||(c[a[b]]=!0,f.push(a[b]));return f}function c(a,c){function f(a,c){return a-c}var b=0,e=0,d=[];a=a.sort(f);for(c=c.sort(f);b<a.length&&e<c.length;)a[b]<c[e]?b++:(a[b]>c[e]||(d.push(a[b]),b++),e++);return d}d.mixin(b.prototype,{bootstrap:function(a){this.datums=a.datums;this.trie=a.trie},add:function(a){var c=this;a=d.isArray(a)?a:[a];d.each(a,function(a){var b;b=c.datums.push(a)-1;a=h(c.datumTokenizer(a));
d.each(a,function(a){var f,e;f=c.trie;for(a=a.split("");e=a.shift();)f=f.children[e]||(f.children[e]={ids:[],children:{}}),f.ids.push(b)})})},get:function(a){var b=this,f;a=h(this.queryTokenizer(a));d.each(a,function(a){var e,d;if(f&&0===f.length)return!1;e=b.trie;for(a=a.split("");e&&(d=a.shift());)e=e.children[d];if(e&&0===a.length)e=e.ids.slice(0),f=f?c(f,e):e;else return f=[],!1});return f?d.map(e(f),function(a){return b.datums[a]}):[]},serialize:function(){return{datums:this.datums,trie:this.trie}}});
return b}(),u=function(){return{local:function(b){b=b.local||null;d.isFunction(b)&&(b=b.call(null));return b},prefetch:function(b){var h;h={url:null,thumbprint:"",ttl:864E5,filter:null,ajax:{}};if(b=b.prefetch||null)b=d.isString(b)?{url:b}:b,b=d.mixin(h,b),b.thumbprint="0.10.1"+b.thumbprint,b.ajax.type=b.ajax.type||"GET",b.ajax.dataType=b.ajax.dataType||"json",!b.url&&g.error("prefetch requires url to be set");return b},remote:function(b){function h(a){return function(c){return d.debounce(c,a)}}function e(a){return function(c){return d.throttle(c,
a)}}var c;c={url:null,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}};if(b=b.remote||null)b=d.isString(b)?{url:b}:b,b=d.mixin(c,b),b.rateLimiter=/^throttle$/i.test(b.rateLimitBy)?e(b.rateLimitWait):h(b.rateLimitWait),b.ajax.type=b.ajax.type||"GET",b.ajax.dataType=b.ajax.dataType||"json",delete b.rateLimitBy,delete b.rateLimitWait,!b.url&&g.error("remote requires url to be set");return b}}}();window.Bloodhound=function(){function b(c){c&&(c.local||
c.prefetch||c.remote)||g.error("one of local, prefetch, or remote is required");this.limit=c.limit||5;this.sorter=h(c.sorter);this.dupDetector=c.dupDetector||e;this.local=u.local(c);this.prefetch=u.prefetch(c);this.remote=u.remote(c);this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null;this.index=new O({datumTokenizer:c.datumTokenizer,queryTokenizer:c.queryTokenizer});this.storage=this.cacheKey?new M(this.cacheKey):null}function h(c){function a(a){return a.sort(c)}function b(a){return a}
return d.isFunction(c)?a:b}function e(){return!1}b.tokenizers={whitespace:function(c){return c.split(/\s+/)},nonword:function(c){return c.split(/\W+/)}};d.mixin(b.prototype,{_loadPrefetch:function(c){function a(a){a=c.filter?c.filter(a):a;b.add(a);b._saveToStorage(b.index.serialize(),c.thumbprint,c.ttl)}var b=this,f;(f=this._readFromStorage(c.thumbprint))?(this.index.bootstrap(f),f=g.Deferred().resolve()):f=g.ajax(c.url,c.ajax).done(a);return f},_getFromRemote:function(c,a){var b=this,f;c=c||"";f=
encodeURIComponent(c);f=this.remote.replace?this.remote.replace(this.remote.url,c):this.remote.url.replace(this.remote.wildcard,f);return this.transport.get(f,this.remote.ajax,function(c){c=b.remote.filter?b.remote.filter(c):c;a(c)})},_saveToStorage:function(c,a,b){this.storage&&(this.storage.set("data",c,b),this.storage.set("protocol",location.protocol,b),this.storage.set("thumbprint",a,b))},_readFromStorage:function(c){var a,b,f;this.storage&&(a=this.storage.get("data"),b=this.storage.get("protocol"),
f=this.storage.get("thumbprint"));c=f!==c||b!==location.protocol;return a&&!c?a:null},initialize:function(){function c(){a.add(a.local)}var a=this,b;b=this.prefetch?this._loadPrefetch(this.prefetch):g.Deferred().resolve();this.local&&b.done(c);this.transport=this.remote?new N(this.remote):null;this.initialize=function(){return b.promise()};return b.promise()},add:function(c){this.index.add(c)},get:function(c,a){function b(c){var k=e.slice(0);d.each(c,function(a){!d.some(k,function(c){return f.dupDetector(a,
c)})&&k.push(a);return k.length<f.limit});a&&a(f.sorter(k))}var f=this,e,g=!1;e=this.index.get(c);e=this.sorter(e).slice(0,this.limit);e.length<this.limit&&this.transport&&(g=this._getFromRemote(c,b));!g&&a&&a(e)},ttAdapter:function(){return d.bind(this.get,this)}});return b}();E='<span class="twitter-typeahead"></span>';F='<span class="tt-dropdown-menu"></span>';G='<div class="tt-dataset-%CLASS%"></div>';H='<span class="tt-suggestions"></span>';I='<div class="tt-suggestion">%BODY%</div>';w={position:"relative",
display:"inline-block"};x={position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"};s={position:"relative",verticalAlign:"top",backgroundColor:"transparent"};y={position:"relative",verticalAlign:"top"};z={position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"};A={display:"block"};B={whiteSpace:"normal"};C={left:"0",right:"auto"};D={left:"auto",right:" 0"};d.isMsie()&&d.mixin(s,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"});
d.isMsie()&&7>=d.isMsie()&&d.mixin(s,{marginTop:"-1px"});var K=function(){function b(b){b&&b.el||g.error("EventBus initialized without el");this.$el=g(b.el)}d.mixin(b.prototype,{trigger:function(b){var e=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+b,e)}});return b}(),v=function(){function b(a,f,b,d){if(!b)return this;f=f.split(c);b=d?e(b,d):b;for(this._callbacks=this._callbacks||{};d=f.shift();)this._callbacks[d]=this._callbacks[d]||{sync:[],async:[]},this._callbacks[d][a].push(b);return this}
function d(a,c,b){return function(){for(var e,d=0;!e&&d<a.length;d+=1)e=!1===a[d].apply(c,b);return!e}}function e(a,c){return a.bind?a.bind(c):function(){a.apply(c,[].slice.call(arguments,0))}}var c=/\s+/,a=function(){return window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},0)}}();return{onSync:function(a,c,e){return b.call(this,"sync",a,c,e)},onAsync:function(a,c,e){return b.call(this,"async",a,c,e)},off:function(a){var f;if(!this._callbacks)return this;
for(a=a.split(c);f=a.shift();)delete this._callbacks[f];return this},trigger:function(b){var f,e,g,n,q;if(!this._callbacks)return this;b=b.split(c);for(g=[].slice.call(arguments,1);(f=b.shift())&&(e=this._callbacks[f]);)n=d(e.sync,this,[f].concat(g)),q=d(e.async,this,[f].concat(g)),n()&&a(q);return this}}}(),P=function(b){function g(c,a,b){for(var f=[],e=0;e<c.length;e++)f.push(d.escapeRegExChars(c[e]));c=b?"\\b("+f.join("|")+")\\b":"("+f.join("|")+")";return a?RegExp(c):RegExp(c,"i")}var e={node:null,
pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(c){function a(a){var e,d;if(e=f.exec(a.data))wrapperNode=b.createElement(c.tagName),c.className&&(wrapperNode.className=c.className),d=a.splitText(e.index),d.splitText(e[0].length),wrapperNode.appendChild(d.cloneNode(!0)),a.parentNode.replaceChild(wrapperNode,d);return!!e}function k(a,c){for(var b,f=0;f<a.childNodes.length;f++)b=a.childNodes[f],3===b.nodeType?f+=c(b)?1:0:k(b,c)}var f;c=d.mixin({},e,c);c.node&&
c.pattern&&(c.pattern=d.isArray(c.pattern)?c.pattern:[c.pattern],f=g(c.pattern,c.caseSensitive,c.wordsOnly),k(c.node,a))}}(window.document),L=function(){function b(c){var a=this,b,f,l,h;c=c||{};c.input||g.error("input is missing");b=d.bind(this._onBlur,this);f=d.bind(this._onFocus,this);l=d.bind(this._onKeydown,this);h=d.bind(this._onInput,this);this.$hint=g(c.hint);this.$input=g(c.input).on("blur.tt",b).on("focus.tt",f).on("keydown.tt",l);0===this.$hint.length&&(this.setHintValue=this.getHintValue=
this.clearHint=d.noop);if(d.isMsie())this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(c){e[c.which||c.keyCode]||d.defer(d.bind(a._onInput,a,c))});else this.$input.on("input.tt",h);this.query=this.$input.val();this.$overflowHelper=g('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"nowrap",fontFamily:this.$input.css("font-family"),fontSize:this.$input.css("font-size"),fontStyle:this.$input.css("font-style"),fontVariant:this.$input.css("font-variant"),
fontWeight:this.$input.css("font-weight"),wordSpacing:this.$input.css("word-spacing"),letterSpacing:this.$input.css("letter-spacing"),textIndent:this.$input.css("text-indent"),textRendering:this.$input.css("text-rendering"),textTransform:this.$input.css("text-transform")}).insertAfter(this.$input)}function h(c){return c.altKey||c.ctrlKey||c.metaKey||c.shiftKey}var e;e={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};b.normalizeQuery=function(c){return(c||"").replace(/^\s*/g,"").replace(/\s{2,}/g,
" ")};d.mixin(b.prototype,v,{_onBlur:function(c){this.resetInputValue();this.trigger("blurred")},_onFocus:function(c){this.trigger("focused")},_onKeydown:function(c){var a=e[c.which||c.keyCode];this._managePreventDefault(a,c);a&&this._shouldTrigger(a,c)&&this.trigger(a+"Keyed",c)},_onInput:function(c){this._checkInputValue()},_managePreventDefault:function(c,a){var b,f;switch(c){case "tab":b=this.getHintValue();f=this.getInputValue();b=b&&b!==f&&!h(a);break;case "up":case "down":b=!h(a);break;default:b=
!1}b&&a.preventDefault()},_shouldTrigger:function(c,a){var b;switch(c){case "tab":b=!h(a);break;default:b=!0}return b},_checkInputValue:function(){var c,a,e;c=this.getInputValue();e=(a=b.normalizeQuery(c)===b.normalizeQuery(this.query))?this.query.length!==c.length:!1;a?e&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query=c)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(c){this.query=
c},getInputValue:function(){return this.$input.val()},setInputValue:function(c,a){this.$input.val(c);!a&&this._checkInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(c){this.$hint.val(c)},resetInputValue:function(){this.$input.val(this.query)},clearHint:function(){this.$hint.val("")},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var c=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());
return this.$overflowHelper.width()>=c},isCursorAtEnd:function(){var c,a;c=this.$input.val().length;a=this.$input[0].selectionStart;return d.isNumber(a)?a===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null}});return b}(),t=function(){function b(a){a=a||{};a.templates=a.templates||{};a.source||g.error("missing source");a.name&&!/^[_a-zA-Z0-9-]+$/.test(a.name)&&
g.error("invalid dataset name: "+a.name);this.query=null;this.highlight=!!a.highlight;this.name=a.name||d.getUniqueId();this.source=a.source;this.displayFn=h(a.display||a.displayKey);this.templates=e(a.templates,this.displayFn);this.$el=g(G.replace("%CLASS%",this.name))}function h(a){function c(b){return b[a]}a=a||"value";return d.isFunction(a)?a:c}function e(a,c){function b(a){return"<p>"+c(a)+"</p>"}return{empty:a.empty&&d.templatify(a.empty),header:a.header&&d.templatify(a.header),footer:a.footer&&
d.templatify(a.footer),suggestion:a.suggestion||b}}var c="ttDataset",a="ttValue",k="ttDatum";b.extractDatasetName=function(a){return g(a).data(c)};b.extractValue=function(c){return g(c).data(a)};b.extractDatum=function(a){return g(a).data(k)};d.mixin(b.prototype,v,{_render:function(b,e){function h(){var n,r;n=g(H).css(A);r=d.map(e,function(b){var e;e=m.templates.suggestion(b);e=I.replace("%BODY%",e);b=g(e).data(c,m.name).data(a,m.displayFn(b)).data(k,b);b.children().each(function(){g(this).css(B)});
return b});n.append.apply(n,r);m.highlight&&P({node:n[0],pattern:b});return n}function n(){return m.templates.header({query:b,isEmpty:!p})}function q(){return m.templates.footer({query:b,isEmpty:!p})}if(this.$el){var m=this,p;this.$el.empty();p=e&&e.length;!p&&this.templates.empty?this.$el.html(m.templates.empty({query:b,isEmpty:!0})).prepend(m.templates.header?n():null).append(m.templates.footer?q():null):p&&this.$el.html(h()).prepend(m.templates.header?n():null).append(m.templates.footer?q():null);
this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(a){var c=this;this.query=a;this.source(a,function(b){a===c.query&&c._render(a,b)})},clear:function(){this._render(this.query||"")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}});return b}(),Q=function(){function b(b){var c=this,a,k,f;b=b||{};b.menu||g.error("menu is required");this.isOpen=!1;this.isEmpty=!0;this.datasets=d.map(b.datasets,h);a=d.bind(this._onSuggestionClick,this);k=
d.bind(this._onSuggestionMouseEnter,this);f=d.bind(this._onSuggestionMouseLeave,this);this.$menu=g(b.menu).on("click.tt",".tt-suggestion",a).on("mouseenter.tt",".tt-suggestion",k).on("mouseleave.tt",".tt-suggestion",f);d.each(this.datasets,function(a){c.$menu.append(a.getRoot());a.onSync("rendered",c._onRendered,c)})}function h(b){return new t(b)}d.mixin(b.prototype,v,{_onSuggestionClick:function(b){this.trigger("suggestionClicked",g(b.currentTarget))},_onSuggestionMouseEnter:function(b){this._removeCursor();
this._setCursor(g(b.currentTarget),!0)},_onSuggestionMouseLeave:function(b){this._removeCursor()},_onRendered:function(){(this.isEmpty=d.every(this.datasets,function(b){return b.isEmpty()}))?this._hide():this.isOpen&&this._show();this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(b,
c){b.first().addClass("tt-cursor");!c&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(b){var c,a;this.isOpen&&(a=this._getCursor(),c=this._getSuggestions(),this._removeCursor(),b=c.index(a)+b,b=(b+1)%(c.length+1)-1,-1===b?this.trigger("cursorRemoved"):(-1>b&&(b=c.length-1),this._setCursor(c=c.eq(b)),this._ensureVisible(c)))},_ensureVisible:function(b){var c,a,d;c=b.position().top;b=c+b.outerHeight(!0);a=this.$menu.scrollTop();
d=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);0>c?this.$menu.scrollTop(a+c):d<b&&this.$menu.scrollTop(a+(b-d))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(b){this.$menu.css("ltr"===b?C:D)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},
getDatumForSuggestion:function(b){var c=null;b.length&&(c={raw:t.extractDatum(b),value:t.extractValue(b),datasetName:t.extractDatasetName(b)});return c},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(b){d.each(this.datasets,function(c){c.update(b)})},empty:function(){d.each(this.datasets,function(b){b.clear()});this.isEmpty=!0},isVisible:function(){return this.isOpen&&
!this.isEmpty},destroy:function(){this.$menu.off(".tt");this.$menu=null;d.each(this.datasets,function(b){b.destroy()})}});return b}(),R=function(){function b(a){var b,c,e;a=a||{};a.input||g.error("missing input");this.autoselect=!!a.autoselect;this.minLength=d.isNumber(a.minLength)?a.minLength:1;this.$node=h(a.input,a.withHint);b=this.$node.find(".tt-dropdown-menu");c=this.$node.find(".tt-input");e=this.$node.find(".tt-hint");this.eventBus=a.eventBus||new K({el:c});this.dropdown=(new Q({menu:b,datasets:a.datasets})).onSync("suggestionClicked",
this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=(new L({input:c,hint:e})).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",
this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this);b.on("mousedown.tt",function(a){d.isMsie()&&9>d.isMsie()&&(c[0].onbeforedeactivate=function(){window.event.returnValue=!1;c[0].onbeforedeactivate=null});a.preventDefault()})}function h(a,b){var f,d,e,h;f=g(a);d=g(E).css(w);e=g(F).css(z);h=f.clone().css(x).css({backgroundAttachment:f.css("background-attachment"),
backgroundClip:f.css("background-clip"),backgroundColor:f.css("background-color"),backgroundImage:f.css("background-image"),backgroundOrigin:f.css("background-origin"),backgroundPosition:f.css("background-position"),backgroundRepeat:f.css("background-repeat"),backgroundSize:f.css("background-size")});h.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled",!0).attr({autocomplete:"off",spellcheck:"false"});f.data(c,{dir:f.attr("dir"),autocomplete:f.attr("autocomplete"),
spellcheck:f.attr("spellcheck"),style:f.attr("style")});f.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(b?s:y);try{!f.attr("dir")&&f.attr("dir","auto")}catch(q){}return f.wrap(d).parent().prepend(b?h:null).append(e)}function e(a){var b=a.find(".tt-input");d.each(b.data(c),function(a,c){d.isUndefined(a)?b.removeAttr(c):b.attr(c,a)});b.detach().removeData(c).removeClass("tt-input").insertAfter(a);a.remove()}var c="ttAttrs";d.mixin(b.prototype,{_onSuggestionClicked:function(a,b){var c;
(c=this.dropdown.getDatumForSuggestion(b))&&this._select(c)},_onCursorMoved:function(){var a=this.dropdown.getDatumForCursor();this.input.clearHint();this.input.setInputValue(a.value,!0);this.eventBus.trigger("cursorchanged",a.raw,a.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint();this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint();this.eventBus.trigger("closed")},
_onFocused:function(){this.dropdown.empty();this.dropdown.open()},_onBlurred:function(){this.dropdown.close()},_onEnterKeyed:function(a,b){var c,d;c=this.dropdown.getDatumForCursor();d=this.dropdown.getDatumForTopSuggestion();c?(this._select(c),b.preventDefault()):this.autoselect&&d&&(this._select(d),b.preventDefault())},_onTabKeyed:function(a,b){var c;(c=this.dropdown.getDatumForCursor())?(this._select(c),b.preventDefault()):this._autocomplete()},_onEscKeyed:function(){this.dropdown.close();this.input.resetInputValue()},
_onUpKeyed:function(){var a=this.input.getQuery();!this.dropdown.isOpen&&a.length>=this.minLength&&this.dropdown.update(a);this.dropdown.open();this.dropdown.moveCursorUp()},_onDownKeyed:function(){var a=this.input.getQuery();!this.dropdown.isOpen&&a.length>=this.minLength&&this.dropdown.update(a);this.dropdown.open();this.dropdown.moveCursorDown()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(a,
b){this.input.clearHint();this.dropdown.empty();b.length>=this.minLength&&this.dropdown.update(b);this.dropdown.open();this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function(){var a;this.dir!==(a=this.input.getLanguageDirection())&&(this.dir=a,this.$node.css("direction",a),this.dropdown.setLanguageDirection(a))},_updateHint:function(){var a,b,c;(a=this.dropdown.getDatumForTopSuggestion())&&this.dropdown.isVisible()&&!this.input.hasOverflow()&&
(b=this.input.getInputValue(),c=L.normalizeQuery(b),c=d.escapeRegExChars(c),c=RegExp("^(?:"+c+")(.*$)","i"),a=c.exec(a.value),this.input.setHintValue(b+(a?a[1]:"")))},_autocomplete:function(){var a,b;a=this.input.getHintValue();b=this.input.getQuery();a&&b!==a&&this.input.isCursorAtEnd()&&((a=this.dropdown.getDatumForTopSuggestion())&&this.input.setInputValue(a.value),this.eventBus.trigger("autocompleted",a.raw,a.datasetName))},_select:function(a){this.input.clearHint();this.input.setQuery(a.value);
this.input.setInputValue(a.value,!0);this._setLanguageDirection();this.eventBus.trigger("selected",a.raw,a.datasetName);this.dropdown.close();d.defer(d.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},getQuery:function(){return this.input.getQuery()},setQuery:function(a){this.input.setInputValue(a)},destroy:function(){this.input.destroy();this.dropdown.destroy();e(this.$node);this.$node=null}});return b}();(function(){var b,h,
e;b=g.fn.typeahead;h="ttTypeahead";e={initialize:function(b,a){a=d.isArray(a)?a:[].slice.call(arguments,1);b=b||{};return this.each(function(){var e=g(this),f;d.each(a,function(a){a.highlight=!!b.highlight});f=new R({input:e,eventBus:new K({el:e}),withHint:d.isUndefined(b.hint)?!0:!!b.hint,minLength:b.minLength,autoselect:b.autoselect,datasets:a});e.data(h,f)})},open:function(){return this.each(function(){var b;(b=g(this).data(h))&&b.open()})},close:function(){return this.each(function(){var b;(b=
g(this).data(h))&&b.close()})},val:function(b){function a(){var a;(a=g(this).data(h))&&a.setQuery(b)}function d(a){var b;if(a=a.data(h))b=a.getQuery();return b}return arguments.length?this.each(a):d(this.first())},destroy:function(){return this.each(function(){var b=g(this),a;if(a=b.data(h))a.destroy(),b.removeData(h)})}};g.fn.typeahead=function(b){return e[b]?e[b].apply(this,[].slice.call(arguments,1)):e.initialize.apply(this,arguments)};g.fn.typeahead.noConflict=function(){g.fn.typeahead=b;return this}})()})(window.jQuery);
