(function(f){function m(a,b){"string"===typeof a[b]&&(a[b]*=1)}function k(a,b){var c=f.extend({},f.fn.autoNumeric.defaults,b);f.metadata&&(c=f.extend(c,a.metadata()));var d=c;f.each(d,function(b,c){if("function"===typeof c)d[b]=c(a,d,b);else if("string"===typeof c){var e=c.substr(0,4);"fun:"===e?d[b]="function"===typeof f.autoNumeric[c.substr(4)]?f.autoNumeric[c.substr(4)](a,d,b):null:"css:"===e&&(d[b]=f(c.substr(4)).val())}});var e=c.vMax.toString().split("."),i=!c.vMin&&0!==c.vMin?[]:c.vMin.toString().split(".");
m(c,"vMax");m(c,"vMin");m(c,"mDec");c.aNeg=0>c.vMin?"-":"";"number"!==typeof c.mDec&&(c.mDec=Math.max((e[1]?e[1]:"").length,(i[1]?i[1]:"").length));null===c.altDec&&0<c.mDec&&("."===c.aDec&&","!==c.aSep?c.altDec=",":","===c.aDec&&"."!==c.aSep&&(c.altDec="."));e=c.aNeg?"([-\\"+c.aNeg+"]?)":"(-?)";c._aNegReg=e;c._skipFirst=RegExp(e+"[^-"+(c.aNeg?"\\"+c.aNeg:"")+"\\"+c.aDec+"\\d].*?(\\d|\\"+c.aDec+"\\d)");c._skipLast=RegExp("(\\d\\"+c.aDec+"?)[^\\"+c.aDec+"\\d]\\D*$");i=(c.aNeg?c.aNeg:"-")+c.aNum+"\\"+
c.aDec;c.altDec&&c.altDec!==c.aSep&&(i+=c.altDec);c._allowed=RegExp("[^"+i+"]","gi");c._numReg=RegExp(e+"(?:\\"+c.aDec+"?(\\d+\\"+c.aDec+"\\d+)|(\\d*(?:\\"+c.aDec+"\\d*)?))");return c}function g(a,b,c){if(b.aSign)for(;-1<a.indexOf(b.aSign);)a=a.replace(b.aSign,"");a=a.replace(b._skipFirst,"$1$2");a=a.replace(b._skipLast,"$1");a=a.replace(b._allowed,"");b.altDec&&(a=a.replace(b.altDec,b.aDec));a=(a=a.match(b._numReg))?[a[1],a[2],a[3]].join(""):"";c&&(b="^"+b._aNegReg+"0*(\\d"+("leading"===c?")":"|$)"),
b=RegExp(b),a=a.replace(b,"$1$2"));return a}function t(a,b,c){if(b&&c){var d=a.split(b);d[1]&&d[1].length>c&&(0<c?(d[1]=d[1].substring(0,c),a=d.join(b)):a=d[0])}return a}function n(a,b,c){b&&"."!==b&&(a=a.replace(b,"."));c&&"-"!==c&&(a=a.replace(c,"-"));a.match(/\d/)||(a+="0");return a}function u(a,b,c){c&&"-"!==c&&(a=a.replace("-",c));b&&"."!==b&&(a=a.replace(".",b));return a}function p(a,b){var a=g(a,b),a=t(a,b.aDec,b.mDec),a=n(a,b.aDec,b.aNeg),c=+a;return c>=b.vMin&&c<=b.vMax}function l(a,b,c){return""===
a||a===b.aNeg?"zero"===b.wEmpty?a+"0":"sign"===b.wEmpty||c?a+b.aSign:a:null}function q(a,b){var a=g(a,b),c=l(a,b,!0);if(null!==c)return c;var c="",c=2===b.dGroup?/(\d)((\d)(\d{2}?)+)$/:4===b.dGroup?/(\d)((\d{4}?)+)$/:/(\d)((\d{3}?)+)$/,d=a.split(b.aDec);b.altDec&&1===d.length&&(d=a.split(b.altDec));var e=d[0];if(b.aSep)for(;c.test(e);)e=e.replace(c,"$1"+b.aSep+"$2");0!==b.mDec&&1<d.length?(d[1].length>b.mDec&&(d[1]=d[1].substring(0,b.mDec)),a=e+b.aDec+d[1]):a=e;b.aSign&&(c=-1!==a.indexOf(b.aNeg),
a=a.replace(b.aNeg,""),a="p"===b.pSign?b.aSign+a:a+b.aSign,c&&(a=b.aNeg+a));return a}function r(a,b,c,d){var a=""===a?"0":a.toString(),e="",e=0,f="",g="boolean"===typeof d||null===d?d?b:0:+d,d=function(a){a=a.replace(0===g?/(\.[1-9]*)0*$/:1===g?/(\.\d[1-9]*)0*$/:RegExp("(\\.\\d{"+g+"}[1-9]*)0*$"),"$1");0===g&&(a=a.replace(/\.$/,""));return a};"-"===a.charAt(0)&&(f="-",a=a.replace("-",""));a.match(/^\d/)||(a="0"+a);"-"===f&&0===+a&&(f="");0<+a&&(a=a.replace(/^0*(\d)/,"$1"));var j=a.lastIndexOf("."),
h=a.length-1-(-1===j?a.length-1:j);if(h<=b){e=a;if(h<g)for(-1===j&&(e+=".");h<g;)c="000000".substring(0,g-h),e+=c,h+=c.length;else h>g?e=d(e):0===h&&0===g&&(e=e.replace(/\.$/,""));return f+e}b=j+b;e=+a.charAt(b+1);h=a.substring(0,b+1).split("");a="."===a.charAt(b)?a.charAt(b-1)%2:a.charAt(b)%2;if(4<e&&"S"===c||4<e&&"A"===c&&""===f||5<e&&"A"===c&&"-"===f||5<e&&"s"===c||5<e&&"a"===c&&""===f||4<e&&"a"===c&&"-"===f||5<e&&"B"===c||5===e&&"B"===c&&1===a||0<e&&"C"===c&&""===f||0<e&&"F"===c&&"-"===f||0<e&&
"U"===c)for(e=h.length-1;0<=e;e-=1)if("."!==h[e])if(h[e]=+h[e]+1,10>h[e])break;else 0<e&&(h[e]="0");h=h.slice(0,b+1);e=d(h.join(""));return f+e}function v(a,b){this.options=b;this.that=a;this.$that=f(a);this.formatted=!1;this.io=k(this.$that,this.options);this.value=a.value}function j(a,b){var c;c=a.data("autoNumeric");c||(c={},a.data("autoNumeric",c));var d=c.holder;void 0===d&&b&&(d=new v(a.get(0),b),c.holder=d);return d}function w(a){return(a=a.data("autoNumeric"))&&a.holder?a.holder.options:{}}
function x(a){var b=f(a.target),b=j(b);b.init(a);if(b.skipAllways(a))return b.processed=!0;if(b.processAllways())return b.processed=!0,b.formatQuick(),a.preventDefault(),!1;b.formatted=!1;return!0}function y(a){var b=f(a.target),b=j(b),c=b.processed;b.init(a);if(b.skipAllways(a))return!0;if(c)return a.preventDefault(),!1;if(b.processAllways()||b.processKeypress())return b.formatQuick(),a.preventDefault(),!1;b.formatted=!1}function z(a){var b=f(a.target),b=j(b);b.init(a);a=b.skipAllways(a);b.kdCode=
0;delete b.valuePartsBeforePaste;if(a||""===this.value)return!0;b.formatted||b.formatQuick()}function A(a){var a=f(a.target),b=j(a);b.inVal=a.val();b=l(b.inVal,b.io,!0);null!==b&&a.val(b)}function B(a){var a=f(a.target),b=j(a),c=b.io,d=a.val(),e=d;""!==d&&(d=g(d,c),null===l(d,c)&&p(d,c)?(d=n(d,c.aDec,c.aNeg),d=r(d,c.mDec,c.mRound,c.aPad),d=u(d,c.aDec,c.aNeg)):d="");var i=l(d,c,!1);null===i&&(i=q(d,c));i!==e&&a.val(i);i!==b.inVal&&(a.change(),delete b.inVal)}function s(a){"string"===typeof a&&(a=a.replace(/\[/g,
"\\[").replace(/\]/g,"\\]"),a="#"+a.replace(/(:|\.)/g,"\\$1"));return f(a)}v.prototype={init:function(a){this.value=this.that.value;this.io=k(this.$that,this.options);this.ctrlKey=a.ctrlKey;this.cmdKey=a.metaKey;this.shiftKey=a.shiftKey;var b=this.that,c={};if(void 0===b.selectionStart){b.focus();var d=document.selection.createRange();c.length=d.text.length;d.moveStart("character",-b.value.length);c.end=d.text.length;c.start=c.end-c.length}else c.start=b.selectionStart,c.end=b.selectionEnd,c.length=
c.end-c.start;this.selection=c;if("keydown"===a.type||"keyup"===a.type)this.kdCode=a.keyCode;this.which=a.which;this.formatted=this.processed=!1},setSelection:function(a,b,c){a=Math.max(a,0);b=Math.min(b,this.that.value.length);this.selection={start:a,end:b,length:b-a};if(void 0===c||c)c=this.that,void 0===c.selectionStart?(c.focus(),c=c.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()):(c.selectionStart=a,c.selectionEnd=b)},setPosition:function(a,b){this.setSelection(a,
a,b)},getBeforeAfter:function(){var a=this.value,b=a.substring(0,this.selection.start),a=a.substring(this.selection.end,a.length);return[b,a]},getBeforeAfterStriped:function(){var a=this.getBeforeAfter();a[0]=g(a[0],this.io);a[1]=g(a[1],this.io);return a},normalizeParts:function(a,b){var c=this.io,b=g(b,c),d=b.match(/^\d/)?!0:"leading",a=g(a,c,d);if(""===a||a===c.aNeg)""<b&&(b=b.replace(/^0*(\d)/,"$1"));d=a+b;if(c.aDec){var e=d.match(RegExp("^"+c._aNegReg+"\\"+c.aDec));e&&(a=a.replace(e[1],e[1]+"0"),
d=a+b)}if("zero"===c.wEmpty&&(d===c.aNeg||""===d))a+="0";return[a,b]},setValueParts:function(a,b){var c=this.io,d=this.normalizeParts(a,b),e=d.join(""),d=d[0].length;return p(e,c)?(e=t(e,c.aDec,c.mDec),d>e.length&&(d=e.length),this.value=e,this.setPosition(d,!1),!0):!1},signPosition:function(){var a=this.io,b=a.aSign,c=this.that;if(b){b=b.length;if("p"===a.pSign)return a.aNeg&&c.value&&c.value.charAt(0)===a.aNeg?[1,b+1]:[0,b];a=c.value.length;return[a-b,a]}return[1E3,-1]},expandSelectionOnSign:function(a){var b=
this.signPosition(),c=this.selection;c.start<b[1]&&c.end>b[0]&&((c.start<b[0]||c.end>b[1])&&this.value.substring(Math.max(c.start,b[0]),Math.min(c.end,b[1])).match(/^\s*$/)?c.start<b[0]?this.setSelection(c.start,b[0],a):this.setSelection(b[1],c.end,a):this.setSelection(Math.min(c.start,b[0]),Math.max(c.end,b[1]),a))},checkPaste:function(){if(void 0!==this.valuePartsBeforePaste){var a=this.getBeforeAfter(),b=this.valuePartsBeforePaste;delete this.valuePartsBeforePaste;a[0]=a[0].substr(0,b[0].length)+
g(a[0].substr(b[0].length),this.io);this.setValueParts(a[0],a[1])||(this.value=b.join(""),this.setPosition(b[0].length,!1))}},skipAllways:function(a){var b=this.kdCode,c=this.which,d=this.ctrlKey,e=this.cmdKey;return 17===b&&"keyup"===a.type&&void 0!==this.valuePartsBeforePaste?(this.checkPaste(),!1):112<=b&&123>=b||(91<=b&&93>=b||9<=b&&31>=b||8>b&&(0===c||c===b)||144===b||145===b||45===b)||(d||e)&&65===b?!0:(d||e)&&(67===b||86===b||88===b)?("keydown"===a.type&&this.expandSelectionOnSign(),86===b&&
("keydown"===a.type||"keypress"===a.type?void 0===this.valuePartsBeforePaste&&(this.valuePartsBeforePaste=this.getBeforeAfter()):this.checkPaste()),"keydown"===a.type||"keypress"===a.type||67===b):d||e?!0:37===b||39===b?(c=this.io.aSep,d=this.selection.start,e=this.that.value,"keydown"===a.type&&(c&&!this.shiftKey)&&(37===b&&e.charAt(d-2)===c?this.setPosition(d-1):39===b&&e.charAt(d)===c&&this.setPosition(d+1)),!0):34<=b&&40>=b?!0:!1},processAllways:function(){var a;return 8===this.kdCode||46===this.kdCode?
(this.selection.length?(this.expandSelectionOnSign(!1),a=this.getBeforeAfterStriped()):(a=this.getBeforeAfterStriped(),8===this.kdCode?a[0]=a[0].substring(0,a[0].length-1):a[1]=a[1].substring(1,a[1].length)),this.setValueParts(a[0],a[1]),!0):!1},processKeypress:function(){var a=this.io,b=String.fromCharCode(this.which),c=this.getBeforeAfterStriped(),d=c[0],c=c[1];if(b===a.aDec||a.altDec&&b===a.altDec||("."===b||","===b)&&110===this.kdCode){if(!a.mDec||!a.aDec||a.aNeg&&-1<c.indexOf(a.aNeg)||-1<d.indexOf(a.aDec)||
0<c.indexOf(a.aDec))return!0;0===c.indexOf(a.aDec)&&(c=c.substr(1));this.setValueParts(d+a.aDec,c);return!0}if("-"===b||"+"===b){if(!a.aNeg)return!0;""===d&&-1<c.indexOf(a.aNeg)&&(d=a.aNeg,c=c.substring(1,c.length));d=d.charAt(0)===a.aNeg?d.substring(1,d.length):"-"===b?a.aNeg+d:d;this.setValueParts(d,c);return!0}"0"<=b&&"9">=b&&(a.aNeg&&(""===d&&-1<c.indexOf(a.aNeg))&&(d=a.aNeg,c=c.substring(1,c.length)),this.setValueParts(d+b,c));return!0},formatQuick:function(){var a=this.io,b=this.getBeforeAfterStriped(),
c=q(this.value,this.io),d=c.length;if(c){var b=b[0].split(""),e;for(e=0;e<b.length;e+=1)b[e].match("\\d")||(b[e]="\\"+b[e]);b=RegExp("^.*?"+b.join(".*?"));if(b=c.match(b)){if(d=b[0].length,(0===d&&c.charAt(0)!==a.aNeg||1===d&&c.charAt(0)===a.aNeg)&&a.aSign&&"p"===a.pSign)d=this.io.aSign.length+("-"===c.charAt(0)?1:0)}else a.aSign&&"s"===a.pSign&&(d-=a.aSign.length)}this.that.value=c;this.setPosition(d);this.formatted=!0}};f.fn.autoNumeric=function(a){return this.each(function(){var b=a,b=b||{},c=
f(this),d=j(c,b);d.io.aForm&&(this.value||"empty"!==d.io.wEmpty)&&c.autoNumericSet(c.autoNumericGet(b),b)}).unbind(".autoNumeric").bind({"keydown.autoNumeric":x,"keypress.autoNumeric":y,"keyup.autoNumeric":z,"focusin.autoNumeric":A,"focusout.autoNumeric":B})};f.autoNumeric={};f.autoNumeric.Strip=function(a,b){var c=s(a),d=w(c);b&&"object"===typeof b&&(d=f.extend({},d,b));c=k(c,d);d=s(a).val();d=g(d,c);d=n(d,c.aDec,c.aNeg);0===+d&&(d="0");return d};f.autoNumeric.Format=function(a,b,c){var a=s(a),d=
w(a);c&&"object"===typeof c&&(d=f.extend({},d,c));b.toString();c=k(a,d);b=r(b,c.mDec,c.mRound,c.aPad);b=u(b,c.aDec,c.aNeg);p(b,c)||(b=r("",c.mDec,c.mRound,c.aPad));return q(b,c)};f.fn.autoNumericGet=function(a){return a?f.autoNumeric.Strip(this,a):f.autoNumeric.Strip(this)};f.fn.autoNumericSet=function(a,b){return b?this.val(f.autoNumeric.Format(this,a,b)):this.val(f.fn.autoNumeric.Format(this,a))};f.autoNumeric.defaults={aNum:"0123456789",aSep:",",dGroup:"3",aDec:".",altDec:null,aSign:"",pSign:"p",
vMax:"999999999.99",vMin:"0.00",mDec:null,mRound:"S",aPad:!0,wEmpty:"empty",aForm:!1};f.fn.autoNumeric.defaults=f.autoNumeric.defaults;f.fn.autoNumeric.Strip=f.autoNumeric.Strip;f.fn.autoNumeric.Format=f.autoNumeric.Format})(jQuery);
